<!doctype html><html lang=zh-CN><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://aaronnick.github.io/favicon.ico><title>Mac｜VPN 自动重连脚本 | 叶星优酸乳</title>
<meta name=title content="Mac｜VPN 自动重连脚本"><meta name=description content="VPN 在实际使用当中，由于系统的机制常常导致使用不愉快——切换网络/息屏/睡眠等情况下自动断开。 我虽然只……"><meta name=keywords content><meta property="og:url" content="https://aaronnick.github.io/posts/macvpn-%E8%87%AA%E5%8A%A8%E9%87%8D%E8%BF%9E%E8%84%9A%E6%9C%AC/"><meta property="og:site_name" content="叶星优酸乳"><meta property="og:title" content="Mac｜VPN 自动重连脚本"><meta property="og:description" content="VPN 在实际使用当中，由于系统的机制常常导致使用不愉快——切换网络/息屏/睡眠等情况下自动断开。 我虽然只……"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-30T12:29:21+08:00"><meta property="article:modified_time" content="2021-04-09T22:40:14+08:00"><meta property="og:image" content="https://aaronnick.github.io/icons/apple-touch-icon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aaronnick.github.io/icons/apple-touch-icon.png"><meta name=twitter:title content="Mac｜VPN 自动重连脚本"><meta name=twitter:description content="VPN 在实际使用当中，由于系统的机制常常导致使用不愉快——切换网络/息屏/睡眠等情况下自动断开。 我虽然只……"><meta itemprop=name content="Mac｜VPN 自动重连脚本"><meta itemprop=description content="VPN 在实际使用当中，由于系统的机制常常导致使用不愉快——切换网络/息屏/睡眠等情况下自动断开。 我虽然只……"><meta itemprop=datePublished content="2020-08-30T12:29:21+08:00"><meta itemprop=dateModified content="2021-04-09T22:40:14+08:00"><meta itemprop=wordCount content="673"><meta itemprop=image content="https://aaronnick.github.io/icons/apple-touch-icon.png"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>叶星优酸乳</h2></a><nav><a href=/>主页</a>
<a href=/posts/>文章</a></nav></header><main><h1>Mac｜VPN 自动重连脚本</h1><p><i><time datetime=2020-08-30>2020-08-30</time></i></p><content><p>VPN 在实际使用当中，由于系统的机制常常导致使用不愉快——<strong>切换网络/息屏/睡眠等情况下自动断开</strong> 。</p><p>我虽然只是偶尔使用，但是每次使用，难免会遇到以上场景然后断开的情况，接着就得手动去连接，实在是麻烦不已。</p><p>于是我就改良了个脚本，让它<strong>断开后自动重连</strong></p><p>具体步骤如下：</p><ul><li>打开系统自带软件：<strong>脚本编辑器</strong></li><li>新建一个文档，输入代码（见下方）</li><li>代码输入后，点击文件-储存-配置如下：<ul><li>位置：应用程序</li><li>文件格式：应用程序</li><li>选项：<strong>勾选「运行处理程序后保持打开」</strong></li></ul></li><li>保存这个脚本程序，然后去运行即可。如果想要开机启动，可以在 Dock 上右键它-选项-登录时打开</li></ul><p>经过测试，切换网络以及息屏后，脚本会在<strong>几秒内运行</strong> ，然后连接上某个可用的 VPN。</p><p>这个脚本的好处是，可以<strong>省去手动连接的麻烦</strong> ，如果你<strong>有多个可用的 VPN，它可以做到逐个尝试</strong> 。不妨尝试一下。</p><pre><code> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</code></pre><p>|</p><pre><code>on idle
	tell application &quot;System Events&quot;
		tell current location of network preferences
			
			-- check vpn connection status
			set connected_vpn to get name of every service whose (kind is greater than 10 and kind is less than 17) and connected of current configuration is true
			set connect_status to count of connected_vpn
			
			if connect_status is 0 then
				-- get vpn list
				set vpn_list to get name of every service whose (kind is greater than 10 and kind is less than 17)
				
				-- select random one
				set vpn_count to count of vpn_list
				set selected_serial to random number from 1 to vpn_count
				set selected_vpn to item selected_serial of vpn_list
				
				display notification &quot;Connect to &quot; &amp; selected_vpn &amp; &quot; ...&quot;
				
				-- connect select vpn
				set vpn to the service selected_vpn
				if vpn is not null then
					if current configuration of vpn is not connected then
						connect vpn
					end if
				end if
				
			end if
		end tell
		return 30
	end tell
end idle
</code></pre><p>&mdash;|&mdash;</p><p>如果不需要逐一访问每个 VPN，可使用以下脚本，10s检查一次，只需替换 VPN 名字就好，代码来自好友提供。</p><pre><code> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
</code></pre><p>|</p><pre><code>on idle
	set en0 to do shell script &quot;ipconfig getifaddr en0; exit 0&quot;
	if en0 is not &quot;&quot; then
		tell application &quot;System Events&quot;
			tell current location of network preferences
				set vpnConnection to the service &quot;VPN 名字&quot;
				if vpnConnection is not null then
					if current configuration of vpnConnection is not connected then
						connect vpnConnection
					end if
				end if
			end tell
			return 10
		end tell
	end if
end idle
</code></pre><p>&mdash;|&mdash;</p></content><div style=font-size:.8em;display:flex;gap:16px;justify-content:center><p><a href=https://aaronnick.github.io/posts/%E8%BD%AF%E4%BB%B6%E7%94%B5%E8%84%91%E6%93%8D%E4%BD%9C%E6%89%8B%E6%9C%BA/>&lt;&lt; Previous Post</a></p><p>|</p><p><a href=https://aaronnick.github.io/posts/%E5%A4%A7%E6%98%8E%E5%AE%AB%E8%AF%8D%E4%B8%80%E9%83%A8%E5%87%84%E7%BE%8E%E7%9A%84%E6%82%B2%E5%89%A7/>Next Post >></a></p></div><p></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>